<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

// fetch æ˜¯ä¸€å€‹ç­‰åŒæ–¼ XMLHttpRequest çš„æ¦‚å¿µï¼Œæä¾›äº†è¨±å¤šèˆ‡XMLHttpRequestç›¸åŒçš„åŠŸèƒ½ã€‚
// fetch åŒ…æ‹¬äº†Request , Response , Headers , Body ä»¥åŠç”¨æ–¼åˆå§‹åŒ–ç•°æ­¥è«‹æ±‚çš„global fetchï¼Œè€Œç•°æ­¥è«‹æ±‚å‰‡æ˜¯åŸºæ–¼Promiseã€‚
// Promise æ˜¯ä¸€å€‹éåŒæ­¥æ“ä½œåŸ·è¡Œå¾Œçš„çµæœï¼Œåˆå§‹å€¼ç‚º pending ï¼Œæœ€çµ‚çµæœå°‡å›å‚³ æˆåŠŸ (resolved) æˆ– å¤±æ•— (rejected)
// Response ç•¶ Prmoise å›å‚³çµæœç‚º resoloved ï¼Œæœƒå¾—åˆ° Response ç‰©ä»¶ï¼Œå¯ä»¥ç›´æ¥ä»¥ .then() çš„æ–¹å¼é€²è¡Œä¸²æ¥è§£æã€‚
// Response å¯ä»¥åˆ©ç”¨.josn()ï¼Œè®€å–Responseï¼Œè¨­ç‚ºå·²è®€ï¼Œä¸¦ä¸”å›å‚³è¢«è§£æç‚ºJSONæ ¼å¼çš„promiseç‰©ä»¶ã€‚
// è¨­ç‚ºå·²è®€çš„åŸå› ï¼Œæ˜¯å› ç‚ºResponseè¢«è¨­ç½®ç‚º stream çš„æ–¹å¼ï¼Œæ‰€ä»¥ä»–å€‘åªèƒ½å¤ è¢«è®€å–ä¸€æ¬¡ï¼Œç•¶Responseè¢«è§£æéä¸€æ¬¡å¾Œï¼Œå°±ç„¡æ³•åœ¨è§£æç¬¬äºŒæ¬¡äº†ã€‚
const cities = [];
const search = document.querySelector('.search');
const suggestions =  document.querySelector('.suggestions');

fetch(endpoint)
  .then(res => res.json()) //å–å¾— response å¾Œå°‡è³‡æ–™è½‰ç‚ºjson ä¸¦return
  .then(data => cities.push(...data)); // ç”±æ–¼å®£å‘Š cities æ˜¯ä½¿ç”¨ constï¼Œå› æ­¤ä¸èƒ½ç¬¬äºŒæ¬¡è³¦äºˆå€¼ï¼Œæ‰€ä»¥åˆ©ç”¨pushçš„æ–¹å¼å°‡å€¼ä¸Ÿé€²å»[]ä¸­

console.log(cities); // åœ¨é€™åªæœƒçœ‹åˆ°ç©ºå€¼ï¼ŒåŸå› æ˜¯å› ç‚º fetch æ˜¯ä¸€å€‹éåŒæ­¥äº‹ä»¶ï¼Œå› æ¬¡åœ¨ fetch å®Œæˆä¹‹å‰å°±å·²ç¶“å…ˆ console äº†

// RegExp æ­£è¦è¡¨é”å¼ï¼Œç”¨æ˜¯æ–¼åŒ¹é…å­—ä¸²ä¸­çš„çµ„åˆæ¨¡å¼ï¼Œ g è¡¨ç¤ºå…¨å±€åŒ¹é…ï¼Œæ‰¾åˆ°æ‰€æœ‰åŒ¹é…ï¼Œè€Œä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªåŒ¹é…ååœæ­¢ï¼Œi è¡¨ç¤ºå¿½ç•¥å¤§å°å¯«ï¼Œignore case
// match æœƒåœ¨å­—ä¸²å…§æª¢è¦–æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼ï¼Œå¯æ¥æ”¶çš„åƒæ•¸ç‚ºRegExp
function matchDate(word,cities){
  return cities.filter( city => {
    // return city.city.match(/word/gi); -> åœ¨matchä¸­çš„æ­£è¦è¡¨é”å¼ç„¡æ³•ç›´æ¥å¸¶å…¥è®Šæ•¸ï¼Œæœƒç›´æ¥è¢«ç•¶æˆå­—ä¸²ï¼Œå› æ­¤éœ€è¦newä¸€å€‹æ­£è¦è¡¨é”å¼
    const regex = new RegExp(word,'gi'); 
    return city.city.match(regex); 
  })
}

// join() å°‡Arrayè½‰æ›æˆå­—ä¸²å…ƒç´ ä¸¦ä¸”ç”¨æŒ‡å®šçš„åˆ†éš”ç¬¦è™Ÿæˆ–å­—ä¸²åˆ†éš”ï¼Œè‹¥æ²’æœ‰æŒ‡å®šé è¨­ç‚ºé€—è™Ÿ
// replace() æœƒå›å‚³ä¸€å€‹æ–°å­—ä¸²ï¼ŒèˆŠå­—ä¸²ä¸­å«æœ‰æŒ‡å®šå­—ä¸²æ™‚ï¼Œè©²å­—ä¸²æ›¿æ›æˆå¦ä¸€æ®µæ–‡å­—ï¼Œç¬¬ä¸€å€‹çš„åƒæ•¸æ˜¯æŒ‡å®šå­—ä¸²å¯ä»¥æ˜¯å­—ä¸²æˆ–æ˜¯RegExpï¼Œç¬¬äºŒå€‹åƒæ•¸å‰‡æ˜¯è¢«æ›´æ›çš„åƒæ•¸å¯ä»¥æ˜¯å­—ä¸²æˆ–è‘—å‡½å¼
// str.replace(substr/regexp,newString/function)
function displayMatchDate(e){
  const matchCity = matchDate(this.value,cities);
  // console.log(matchCity);
  const html = matchCity.map(place => {
    const regex = new RegExp(this.value,'gi');
    const cityName = place.city.replace(regex,`<span class="hl">${this.value}</span>`); // å°‡inputä¸­è¼¸å…¥çš„å­—ä¸²ä½œç‚ºæŒ‡å®šæ›´æ›çš„åƒæ•¸ï¼Œå°±å¯ä»¥å°‡è©²æŒ‡å®šçš„éƒ¨åˆ†æ›¿æ›æˆåŠ å…¥height lightçš„span tag
    const stateName = place.state.replace(regex,`<span class="hl">${this.value}</span>`)
    console.log(`${cityName} ${stateName}`);
    return `
     <li>
      <span class="name">${cityName} , ${stateName}</span>
      <span class="population">${place.population}</span>
     </li>`;
  }).join(''); // å°‡é™£åˆ—è½‰æ›æˆå­—ä¸²ä¸¦ä½¿ç”¨ç©ºç™½ä½œç‚ºåˆ†éš”
  suggestions.innerHTML = html;
}

search.addEventListener('change',displayMatchDate);
search.addEventListener('keyup',displayMatchDate);

</script>
  </body>
</html>
